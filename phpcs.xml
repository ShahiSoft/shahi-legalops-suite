<?xml version="1.0"?>
<ruleset name="ShahiTemplate WordPress Coding Standards">
    <description>WordPress Coding Standards for ShahiTemplate Plugin</description>

    <!-- Show progress and sniff codes -->
    <arg value="ps"/>
    
    <!-- Check up to 20 files simultaneously -->
    <arg name="parallel" value="20"/>
    
    <!-- Use colors in output -->
    <arg name="colors"/>
    
    <!-- Show sniff names in output -->
    <arg value="ns"/>

    <!-- What to scan -->
    <file>includes</file>
    <file>shahi-template.php</file>

    <!-- Exclude patterns -->
    <exclude-pattern>*/vendor/*</exclude-pattern>
    <exclude-pattern>*/node_modules/*</exclude-pattern>
    <exclude-pattern>*/tests/*</exclude-pattern>
    <exclude-pattern>*/bin/*</exclude-pattern>
    <exclude-pattern>*/assets/vendor/*</exclude-pattern>
    <exclude-pattern>*.min.js</exclude-pattern>
    <exclude-pattern>*.min.css</exclude-pattern>

    <!-- Include WordPress Coding Standards -->
    <rule ref="WordPress-Core">
        <!-- Allow short array syntax -->
        <exclude name="Generic.Arrays.DisallowShortArraySyntax"/>
        
        <!-- Allow multiple statements on one line for simple assignments -->
        <exclude name="Generic.Formatting.DisallowMultipleStatements.SameLine"/>
    </rule>

    <!-- Include WordPress Documentation Standards -->
    <rule ref="WordPress-Docs">
        <!-- We prefer /** style comments for file headers -->
        <exclude name="Squiz.Commenting.FileComment.Missing"/>
    </rule>

    <!-- Include WordPress Security Standards -->
    <rule ref="WordPress.Security"/>

    <!-- Include WordPress Extra Standards -->
    <rule ref="WordPress-Extra">
        <!-- Allow short ternary operators -->
        <exclude name="WordPress.PHP.DisallowShortTernary"/>
    </rule>

    <!-- Enforce WordPress naming conventions -->
    <rule ref="WordPress.NamingConventions">
        <!-- Our namespace uses PascalCase -->
        <exclude name="WordPress.NamingConventions.ValidVariableName.VariableNotSnakeCase"/>
    </rule>

    <!-- Check for PHP cross-version compatibility -->
    <config name="testVersion" value="7.4-"/>
    <rule ref="PHPCompatibilityWP"/>

    <!-- WordPress version compatibility -->
    <config name="minimum_supported_wp_version" value="5.8"/>

    <!-- Verify text domain -->
    <rule ref="WordPress.WP.I18n">
        <properties>
            <property name="text_domain" type="array">
                <element value="shahi-template"/>
            </property>
        </properties>
    </rule>

    <!-- Verify that everything in the global namespace is prefixed -->
    <rule ref="WordPress.NamingConventions.PrefixAllGlobals">
        <properties>
            <property name="prefixes" type="array">
                <element value="shahi"/>
                <element value="ShahiTemplate"/>
                <element value="SHAHI"/>
            </property>
        </properties>
    </rule>

    <!-- Enforce strict types for comparison -->
    <rule ref="WordPress.PHP.StrictComparisons"/>
    
    <!-- Enforce strict in_array() -->
    <rule ref="WordPress.PHP.StrictInArray"/>

    <!-- Check for correct escape functions -->
    <rule ref="WordPress.Security.EscapeOutput">
        <properties>
            <property name="customAutoEscapedFunctions" type="array">
                <!-- PLACEHOLDER: Add custom auto-escaped functions here -->
            </property>
        </properties>
    </rule>

    <!-- Validate sanitization functions -->
    <rule ref="WordPress.Security.ValidatedSanitizedInput"/>

    <!-- Check nonce verification -->
    <rule ref="WordPress.Security.NonceVerification"/>

    <!-- Database queries -->
    <rule ref="WordPress.DB.DirectDatabaseQuery">
        <properties>
            <property name="customCacheGetFunctions" type="array">
                <!-- PLACEHOLDER: Add custom cache functions -->
            </property>
        </properties>
    </rule>

    <!-- Prepared SQL -->
    <rule ref="WordPress.DB.PreparedSQL"/>

    <!-- File system operations -->
    <rule ref="WordPress.WP.AlternativeFunctions"/>

    <!-- Enqueuing scripts and styles -->
    <rule ref="WordPress.WP.EnqueuedResourceParameters"/>

    <!-- Allow short array syntax for PHP 5.4+ -->
    <rule ref="Generic.Arrays.DisallowLongArraySyntax"/>

    <!-- Enforce single or double quotes consistently -->
    <rule ref="Squiz.Strings.DoubleQuoteUsage"/>
    <rule ref="Squiz.Strings.DoubleQuoteUsage.ContainsVar">
        <severity>0</severity>
    </rule>

    <!-- Check for commented out code -->
    <rule ref="Squiz.PHP.CommentedOutCode">
        <properties>
            <property name="maxPercentage" value="50"/>
        </properties>
    </rule>

    <!-- Line length limits -->
    <rule ref="Generic.Files.LineLength">
        <properties>
            <property name="lineLimit" value="120"/>
            <property name="absoluteLineLimit" value="150"/>
        </properties>
    </rule>

    <!-- Check for TODO comments -->
    <rule ref="Generic.Commenting.Todo"/>
    <rule ref="Generic.Commenting.Fixme"/>

    <!-- Forbid dead code -->
    <rule ref="Squiz.PHP.NonExecutableCode"/>

    <!-- Forbid deprecated functions -->
    <rule ref="WordPress.WP.DeprecatedFunctions"/>
    
    <!-- Forbid deprecated parameters -->
    <rule ref="WordPress.WP.DeprecatedParameters"/>
    
    <!-- Forbid deprecated classes -->
    <rule ref="WordPress.WP.DeprecatedClasses"/>

    <!-- Check array declarations -->
    <rule ref="WordPress.Arrays.ArrayDeclarationSpacing"/>
    <rule ref="WordPress.Arrays.ArrayKeySpacingRestrictions"/>
    <rule ref="WordPress.Arrays.ArrayIndentation"/>
    <rule ref="WordPress.Arrays.MultipleStatementAlignment"/>
    <rule ref="WordPress.Arrays.CommaAfterArrayItem"/>

    <!-- Control structures -->
    <rule ref="WordPress.WhiteSpace.ControlStructureSpacing"/>
    <rule ref="WordPress.WhiteSpace.OperatorSpacing"/>
    <rule ref="WordPress.WhiteSpace.CastStructureSpacing"/>

    <!-- Function declarations -->
    <rule ref="PEAR.Functions.ValidDefaultValue"/>
    <rule ref="Squiz.Functions.FunctionDeclarationArgumentSpacing">
        <properties>
            <property name="equalsSpacing" value="1"/>
        </properties>
    </rule>

    <!-- PLACEHOLDER: Custom project-specific rules -->
    <!-- Add any project-specific coding standards here -->
    
</ruleset>
